<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4 p-3 rounded">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="/">
      <!-- <img src="/assets/images/profile_illustration.png" alt="Logo" width="30" height="30"
        class="d-inline-block align-text-top me-2 rounded-circle bg-white"> -->
      My App
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog">Blog</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contact</a>
        </li>
      </ul>
      <ul class="navbar-nav ms-auto" id="authNav">
        <!-- Auth items will be injected here -->
        <li class="nav-item">
          <a class="nav-link" href="/login">Login</a>
        </li>
        <li class="nav-item">
          <a class="btn btn-outline-light ms-2" href="/signup">Sign Up</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script type="module">
  import { authService } from '/src/api/index.js';

  async function updateAuthNav() {
    const authNav = document.getElementById('authNav');
    if (!authNav) return;

    try {
      const user = await authService.getCurrentUser();

      if (user) {
        const name = user.user_metadata?.full_name || user.email;
        const isAdmin = user.user_metadata?.role === 'admin' || user.user_metadata?.role === 'superadmin';

        authNav.innerHTML = `
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              ${name}
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="/profile">Profile</a></li>
              ${isAdmin ? '<li><a class="dropdown-item" href="/admin">Dashboard</a></li>' : ''}
              <li><hr class="dropdown-divider"></li>
              <li><button class="dropdown-item" id="logoutBtn">Logout</button></li>
            </ul>
          </li>
        `;

        document.getElementById('logoutBtn').addEventListener('click', async () => {
          await authService.logout();
          window.location.href = '/';
        });
      }
    } catch (e) {
      console.error('Auth check failed', e);
    }
  }

  updateAuthNav();
</script>

<script>
  (function () {
    // Get current path, ignoring trailing slash for root
    const path = window.location.pathname === '/' ? '/' : window.location.pathname.replace(/\/$/, '');

    // Find link matching current path
    const links = document.querySelectorAll('.navbar-nav .nav-link');
    links.forEach(link => {
      const href = link.getAttribute('href');
      // Simple match: perfect match or (for /blog) starts with
      if (href === path || (href !== '/' && path.startsWith(href))) {
        link.classList.add('active');
        link.style.fontWeight = 'bold'; // Make it pop
      } else {
        link.classList.remove('active');
        link.style.fontWeight = 'normal';
      }
    });
  })();
</script>