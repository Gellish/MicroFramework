<title>Sign Up</title>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow-sm">
                <div class="card-body p-5">
                    <h1 class="h3 mb-4 fw-normal text-center">Create Account</h1>

                    <form id="signupForm">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="floatingName" placeholder="John Doe" required>
                            <label for="floatingName">Full Name</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="floatingInput" placeholder="name@example.com"
                                required>
                            <label for="floatingInput">Email address</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="floatingPassword" placeholder="Password"
                                required>
                            <label for="floatingPassword">Password</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="floatingConfirmPassword"
                                placeholder="Confirm Password" required>
                            <label for="floatingConfirmPassword">Confirm Password</label>
                        </div>

                        <button class="w-100 btn btn-lg btn-success" type="submit" id="signupBtn">Sign Up</button>

                        <hr class="my-4">
                        <div class="text-center">
                            <p class="mb-0">Already have an account? <a href="/login">Login</a></p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { authService } from '/src/api/index.js';

    const form = document.getElementById('signupForm');
    const signupBtn = document.getElementById('signupBtn');
    const alertBox = document.createElement('div');
    alertBox.className = 'alert alert-danger d-none';
    form.insertBefore(alertBox, form.firstChild);

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Reset UI
        alertBox.classList.add('d-none');
        signupBtn.disabled = true;
        signupBtn.textContent = 'Creating Account...';

        const name = document.getElementById('floatingName').value;
        const email = document.getElementById('floatingInput').value;
        const password = document.getElementById('floatingPassword').value;
        const confirmResult = document.getElementById('floatingConfirmPassword').value;

        if (password !== confirmResult) {
            alertBox.textContent = 'Passwords do not match';
            alertBox.classList.remove('d-none');
            signupBtn.disabled = false;
            signupBtn.textContent = 'Sign Up';
            return;
        }

        try {
            const user = await authService.signup(email, password, { full_name: name });
            console.log('Signup successful:', user);
            // Redirect to admin home (or verify email page if enabled)
            window.location.href = '/admin';
        } catch (error) {
            console.error('Signup failed:', error);
            alertBox.textContent = error.message;
            alertBox.classList.remove('d-none');
        } finally {
            signupBtn.disabled = false;
            signupBtn.textContent = 'Sign Up';
        }
    });
</script>